# JetStream
NATS에는 JetStream이라는 분산 지속성 시스템이 내장되어 있으며 기본 '핵심 NATS' 기능 및 서비스 품질 위에 새로운 기능과 더 높은 서비스 품질을 제공한다.  
  
JetStream은 nats 서버에 내장되어 있으며, 모든 클라이언트 애플리케이션에서 사용할 수 있도록 하기 위해 NATS 서버 중 1대(또는 1~2대의 동시 NATS 서버 장애에 대한 내결함성을 원하는 경우 3대 또는 5대)만 JetStream을 사용하도록 설정하면 된다.  
  
JetStream은 오늘날 스트리밍 기술의 문제점으로 지적되는 복잡성, 취약성, 확장성 부족을 해결하기 위해 만들어졌다. 일부 기술은 다른 기술보다 이러한 문제를 더 잘 해결하지만, 현재 스트리밍 기술 중 진정한 멀티 테넌트, 수평적 확장성, 다양한 배포 모델을 지원하는 기술은 없다. 우리가 알고 있는 그 어떤 기술도 운영을 위한 완벽한 배포 가시성을 확보하면서 동일한 보안 컨텍스트에서 엣지에서 클라우드로 확장할 수 없다.    
  
## 목표 
- 시스템 설정이나 운용이 쉬우므로 관측 가능하다
- NATS2.0의 보안 모델로 안전하게 운용할 수 있다
- 시스템은 수평적으로 확장할 수 있어야 하며 높은 수집 속도에 적용할 수 있어야 한다.
- 시스템은 다양한 사용 사례를 지원해야 한다.
- 시스템이 자가 복구되고 항상 사용 가능해야 한다.
- 시스템에 핵심 NATS에 가까운 API가 있어야 한다.
- 시스템은 원하는 대로 NATS 메시지가 스트림의 일부가 될 수 있어야 한다.
- 시스템이 페이로드에 구애받지 않는 동작을 표시해야 한다.
- 시스템에 타사 종속성이 없어야 한다.
  
   
## 제한 사항
스트림은 아래의 제한이 있다
- 최대 메시지 연령
- 스트림 전체의 최대 크기(바이트 단위)
- 스트림 내의 최대 메시지 수
- 개개의 메시지의 최대 크기
- 폐기 정책 지정 가능. 제한에 도달해서 새로운 메시지가 스트림에 공개 되었을 때 이 새로운 메시지를 위해 공간을 확보하기 위해 현재 스트림에 있는 가장 오래된 메시지 또는 가장 새로운 메시지 중 어느쪽을 폐기할지 정할 수 있다.
- 또 임의의 시점에서 스트림에 정의할 수 있는 컨슈머의 수에 제한을 설정할 수도 있다
  

## 기능 리스트
- 윈도우 내에 1번만 배신하는 「At-Least-Once」
- 메시지를 보존하고, 시간 또는 시퀸스로 재생
- 와일드카드 대응
- 계정 인식
- 암호화
- 특정 메시지 클린화(GDPR)
- 수평방향 확장
- 스트림 영속화와 컨슈머에 의한 재생  
    
JetStream은 메시지 모음과 소비를 분산시키고, 같은 스트림에서 데이터를 소비하는 방법을 복수 제공하도록 설계 되어있다. 그래서 JetStream 기능은 서버 스트림과 서버 컨슈머로 구성하고 있다.    


## 키 값 저장소
JetStream은 지속성 계층이며, 스트리밍은 이 계층 위에 구축된 기능 중 하나에 불과하다.  
또 다른 기능(일반적으로 메시징 시스템에서 사용할 수 없거나 메시징 시스템과 연관되어 있지 않은)은 키와 연관된 값 메시지를 저장, 검색 및 삭제하고, 해당 키에서 발생하는 변경 사항을 감시(수신)하며, 특정 키에서 발생한 값(및 삭제)의 기록을 검색할 수 있는 기능인 JetStream 키 값 저장소이다.    
   
   
## 리플레이 정책
JetStream 컨슈머는 컨슈머 애플리케이션이 으느쪽을 수신하고 싶은지에 따라서 복수의 재생 정책을 지원하고 있다.  
  
- 스트림에 현재 저장되어 있는 모든 메시지, 즉 완전한 「재생」을 의미하고, 「재생 정책」(즉 재생 속도)를 아래 중에서 선택할 수 있다.
    - 인스턴드(컨슈머가 처리할 수 있는 속도로 메시지가 배신된다)
    - 오리지널(스트림에 공개된 속도로 컨슈머에 배신되는 것을 의미하고, 실제 트래픽의 스테이징 등에 아주 편리하다)
- 스트림에 저장된 마지막 메시지, 또는 각 서브젝트의 최대 메시지(스트림은 복수의 서브젝트를 묶을 수 있기 때문에)
- 특정 시퀸스 번호에서 시작한다
- 특정 개시 시각에서 시작한다  
  
   

## 리텐션 정책
각 스트림에 대응하여 어떤 리텐션을 할지를 선택할 수 있다.  
- 제한(default)
- interest(스트림 상 컨슈머가 존재하는 한 메시지를 스트림에 보존시킨다)
- 워크 큐(스트림을 공유 큐로서 사용하여 소비된 메시지는 큐에서 삭제)